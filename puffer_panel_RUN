#!/bin/bash
# PufferPanel Docker Installer for systemd-free environments (e.g., Codespaces)

# Display banner
cat << "EOF"

                                                          $$\                               
                                                          $$ |                              
      $$\  $$$$$$\  $$$$$$$$\ $$$$$$$$\          $$$$$$\  $$ | $$$$$$\  $$\   $$\ $$$$$$$$\ 
      \__| \____$$\ \____$$  |\____$$  |        $$  __$$\ $$ | \____$$\ $$ |  $$ |\____$$  |
      $$\  $$$$$$$ |  $$$$ _/   $$$$ _/         $$ /  $$ |$$ | $$$$$$$ |$$ |  $$ |  $$$$ _/ 
      $$ |$$  __$$ | $$  _/    $$  _/           $$ |  $$ |$$ |$$  __$$ |$$ |  $$ | $$  _/   
      $$ |\$$$$$$$ |$$$$$$$$\ $$$$$$$$\         $$$$$$$  |$$ |\$$$$$$$ |\$$$$$$$ |$$$$$$$$\ 
      $$ | \_______|\________|\________|$$$$$$\ $$  ____/ \__| \_______| \____$$ |\________|
$$\   $$ |                              \______|$$ |                    $$\   $$ |          
\$$$$$$  |                                      $$ |                    \$$$$$$  |          
 \______/                                       \__|                     \______/     

EOF

set -e

echo "Creating necessary directories and Docker volume..."
sudo mkdir -p /var/lib/pufferpanel
sudo docker volume create pufferpanel-config

echo "Creating PufferPanel container..."
sudo docker create --name pufferpanel \
    -p 8080:8080 -p 5657:5657 \
    -v pufferpanel-config:/etc/pufferpanel \
    -v /var/lib/pufferpanel:/var/lib/pufferpanel:z \
    -v /var/run/docker.sock:/var/run/docker.sock \
    --restart=on-failure \
    pufferpanel/pufferpanel:latest

echo "Starting PufferPanel container..."
sudo docker start pufferpanel

echo "Adding a PufferPanel user interactively..."
sudo docker exec -it pufferpanel /pufferpanel/pufferpanel user add

echo "âœ… PufferPanel setup completed!"
echo "Access the panel on http://localhost:8080"
